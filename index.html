<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sky Play</title>
    <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
    <script src="./node_modules/@fortawesome/fontawesome-free/js/all.min.js"></script>
</head>

<body>
    <header>
        <div class="bg-dark w-100" style="height: 50px;"></div>
    </header>
    <div class="container">
           <div class="row">
            <!-- carousel -->
            <div class="col-12 py-3">
                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators"></ol>
                    <div class="carousel-inner"></div>
                    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
            <!-- fim carousel -->
            
            <!-- lista filmes -->
            <div class="col-12 py-5">
                <div id="listaFilmes"></div>
            </div>
            <!-- fim lista filmes -->
        </div>
    </div>
    <footer>
        <div class="bg-dark w-100" style="height: 50px;"></div>
    </footer>

    
      
        
    <!-- import de scripts -->
    <script src="./node_modules/jquery/dist/jquery.min.js"></script>
    <script src="./node_modules/@popperjs/core/dist/umd/popper.min.js"></script>
    <script src="./node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- fim import de scripts -->
    
    <!-- script personalizado -->

      <script type="text/javascript">

        $.getJSON( "https://sky-frontend.herokuapp.com/movies", function( data ) {
            console.log(data);
            
            var $response = data; 
            var $highlights = $response[0].items;
            var $movies = $response[2].movies;
            var $organizedMovies = [];

            var $comedia = $movies.filter(function (movie) {
                return movie.categories.includes("Comédia");
            });
            $organizedMovies.push({"Comédia": $comedia});

            var $acaoAventura = $movies.filter(function (movie) {
                return movie.categories.includes("Ação e Aventura");
            });
            $organizedMovies.push({"Ação e Aventura": $acaoAventura});

            var $infantil = $movies.filter(function (movie) {
                return movie.categories.includes("Infantil");
            });
            $organizedMovies.push({"Infantil": $infantil});

            var $animacao = $movies.filter(function (movie) {
                return movie.categories.includes("Animação");
            });
            $organizedMovies.push({"Animação": $animacao});

            var $fantasia = $movies.filter(function (movie) {
                return movie.categories.includes("Fantasia");
            });
            $organizedMovies.push({"Fantasia": $fantasia});

            var $suspense = $movies.filter(function (movie) {
                return movie.categories.includes("Suspense");
            });
            $organizedMovies.push({"Suspense": $suspense});

            var $terror = $movies.filter(function (movie) {
                return movie.categories.includes("Terror");
            });
            $organizedMovies.push({"Terror": $terror});

            var $drama = $movies.filter(function (movie) {
                return movie.categories.includes("Drama");
            });
            $organizedMovies.push({"Drama": $drama});

            var $ficcao = $movies.filter(function (movie) {
                return movie.categories.includes("Ficção Científica");
            });
            $organizedMovies.push({"Ficção Científica": $ficcao});

            var $biografia = $movies.filter(function (movie) {
                return movie.categories.includes("Biografia");
            });
            $organizedMovies.push({"Biografia": $biografia});

            var $musical = $movies.filter(function (movie) {
                return movie.categories.includes("Musical");
            });
            $organizedMovies.push({"Musical": $musical});

            // carrousel dinamico
            $.each( $highlights, function(k, v){
                $(".carousel-inner").append(
                    `<div class="carousel-item">
                    <img class="d-block w-100" src="` + v.images[0].url + `" alt="` + v.description + `">
                    </div>`
                ).find('.carousel-item').first().addClass("active");
                $(".carousel-indicators").append(
                    `<li data-target="#carouselExampleIndicators" data-slide-to=" `+ k +` " class="carouselExampleIndicators"></li>`
                ).find('.carouselExampleIndicators').first().addClass("active");
            });
            // fim carousel dinamico
            
            // lista filmes dinamico
            $.each( $organizedMovies , function(k, v){
                // categorias
                $("#listaFilmes").append(
                    `<div class="w-100">
                    <p class="font-weight-bold">`+ Object.keys(v) +`</p>
                    <div class="filmes-` + k + ` row mb-3"></div>
                    </div>`
                );
                // filmes por categoria
                $.each(Object.values(v), function(){
                    $.each(this, function(index, filme){
                        $(`.filmes-`+ k +``).append(
                            `<div class="col-2 my-2">
                                <div class="p-1" style="position:relative;">
                                    <img class="d-block w-100 rounded" src="` + filme.images[0].url + `" alt=` + filme.title + `">
                                        <span class="fa-stack" style="position: absolute; top: 10px; right: 10px;">
                                            <i class="fas fa-circle fa-stack-2x"></i>
                                            <i class="fas `+ (filme.isBlocked ? `fa-lock` : `fa-shopping-cart`) +` fa-stack-1x fa-inverse"></i>
                                        </span>
                                </div>
                            </div>`
                        );
                    })
                })
            })
            // fim lista filmes dinamico
            
        });
    
    </script>
    <!-- fim script personalizado -->
</body>
</html>